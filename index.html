<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Marriage Connection Assessment</title>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500&family=Open+Sans:wght@600;700&display=swap" rel="stylesheet">

  <style>
    body { font-family: Arial, sans-serif; background: #FFF9F2; color: #1A3C5E; max-width: 900px; margin: auto; padding: 20px; box-sizing: border-box; }
    h1, h2, h3, h4 { text-align: center; line-height: 1.3; }
    .card { background: #FFFFFF; border: 2px solid #4D9DE0; border-radius: 12px; padding: 25px; box-shadow: 0 8px 25px rgba(0,0,0,0.08); margin: 20px auto; max-width: 750px; text-align: center; line-height: 1.3; }
    .btn, .answer-btn { background: #4D9DE0; color: white; font-weight: bold; border: none; border-radius: 8px; padding: 15px 25px; cursor: pointer; margin: 12px auto; display: block; width: 100%; max-width: 500px; text-align: center; touch-action: manipulation; }
    .btn:hover, .answer-btn:hover { background: #3A7FBF; }
    .answer-btn.selected { background: #3A7FBF; transform: scale(0.98); transition: all 0.2s ease; }
    .hidden { display: none; }
    .progress-bar-container { width: 100%; max-width: 500px; height: 10px; background: #E0E0E0; border-radius: 5px; margin: 10px auto; }
    .progress-bar { height: 100%; background: #FF4D4D; border-radius: 5px; transition: width 0.3s ease; }
    .logo { display: block; margin: 0 auto 15px auto; max-width: 200px; }
    .question-box { background: #FFFFFF; border: 1px solid #4D9DE0; border-radius: 8px; padding: 20px; margin: 15px auto; max-width: 700px; text-align: left; }
    .intro-text { margin-bottom: 10px; line-height: 1.3; text-align: left; }
    .intro-text p { margin-bottom: 12pt; }
    .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); border: 0; }

    /* Results */
    #resultPage { line-height: 1.3; color: #1A3C5E; font-family: Arial, sans-serif; }
    .section-title { color: #1A3C5E; font-family: 'Open Sans', sans-serif; font-size: 16pt; font-weight: 700; text-align: center; margin-bottom: 10px; }
    .subsection-title { color: #1A3C5E; font-family: 'Roboto', sans-serif; font-size: 14pt; font-weight: 600; text-align: center; margin: 15px 0 6px; }
    .scripture-line { font-style: italic; text-align: center; margin: 0 0 10px 0; }
    .section-divider { height: 1pt; background-color: #FF4D4D; width: 100%; max-width: 750px; margin: 25pt auto; }
    .subsection-divider { height: 1pt; background-color: rgba(77, 157, 224, 0.5); width: 100%; max-width: 750px; margin: 15pt auto; }
    .result-block { margin-bottom: 16px; page-break-inside: avoid; padding: 20px; border-left: 8px solid; border-radius: 8px; background: #FFFFFF; opacity: 0; transform: translateY(10px); animation: fadeIn 0.5s ease forwards; }
    @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }
    .results-list { list-style-position: outside; margin-left: 20px; text-align: left; line-height: 1.3; }
    .results-list li { margin-bottom: 8px; }

    /* Discussion prompts */
    .discussion-prompts { margin: 12pt 0; text-align: left; }
    .discussion-prompts h5 { margin: 0 0 6px 0; font-size: 1rem; }
    .discussion-prompts ul { margin: 0; padding-left: 18px; }

    .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
    .stack { display: grid; gap: 12px; }
    .partner-name { color: #FF4D4D; font-family: 'Open Sans', sans-serif; font-size: 16pt; font-weight: 700; text-align: center; margin: 10px 0; border-bottom: 2px solid #4D9DE0; padding-bottom: 5px; }

    /* Tables */
    .table-responsive { width: 100%; overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; margin: 20px 0; }
    th, td { border: 1px solid #E0E0E0; padding: 10px; text-align: left; vertical-align: top; }
    th { background: #4D9DE0; color: white; }

    /* Inputs */
    .name-inputs { display: grid; gap: 10px; justify-items: center; margin-top: 10px; }
    .name-inputs input, .name-inputs select { padding: 10px; border: 1px solid #4D9DE0; border-radius: 8px; width: 100%; max-width: 320px; }

    @media (max-width: 700px) {
      .two-col { grid-template-columns: 1fr; }
      .btn, .answer-btn { max-width: 100%; }
      .name-inputs input, .name-inputs select { max-width: 100%; }
      .logo { max-width: 150px; }
    }

    @media (max-width: 400px) {
      body { padding: 10px; }
      .card { padding: 15px; }
      .logo { max-width: 120px; }
      .question-box { padding: 10px; }
      .table-responsive table { font-size: 0.9rem; }
    }
  </style>
</head>
<body>
  <!-- Intro Page -->
  <div id="introPage" class="card">
    <img src="https://static.wixstatic.com/media/4d6372_c110ccf05896482192f466d6c0e3c1ae~mv2.png/v1/fill/w_476,h_194,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/Untitled-28_edited.png" class="logo" alt="Logo" onerror="this.src='https://via.placeholder.com/200x80?text=Logo'"/>
    <h1>Discover Your Marriage Connection Profile</h1>
    <div class="intro-text">
      <p>Take the assessment as an individual or as a couple. In Couple Mode, you’ll see a side-by-side comparison with personalized recommendations.</p>
    </div>
    <div class="name-inputs">
      <label for="mode">Mode</label>
      <select id="mode">
        <option value="individual">Individual</option>
        <option value="couple">Couple</option>
      </select>
      <div id="coupleFields" class="hidden" style="width:100%; max-width: 340px;">
        <input id="p1Name" type="text" placeholder="Partner 1 Name" />
        <input id="p2Name" type="text" placeholder="Partner 2 Name" />
      </div>
    </div>
    <div style="display:flex; justify-content:center;">
      <button id="startQuizBtn" class="btn" style="max-width:250px;">Start Assessment</button>
    </div>
    <p style="color:#A3A3A3; font-size:0.9rem; margin-top:10px;">HappyMarriageHappyLife.com</p>
  </div>

  <!-- Quiz Page -->
  <div id="quizPage" class="card hidden">
    <h2 id="quizHeading">Intimacy Profile Assessment</h2>
    <div class="progress-bar-container"><div class="progress-bar" id="progressBar"></div></div>
    <div class="progress" id="progress"></div>
    <div class="question-box" id="questionContainer" role="radiogroup"></div>
    <button class="btn hidden" id="backBtn" aria-label="Go to previous question">Previous Question</button>
    <p style="color:#A3A3A3; font-size:0.9rem; margin-top:10px;">HappyMarriageHappyLife.com</p>
  </div>

  <!-- Results Page -->
  <div id="resultPage" class="card hidden">
    <img src="https://static.wixstatic.com/media/4d6372_c110ccf05896482192f466d6c0e3c1ae~mv2.png/v1/fill/w_476,h_194,al_c,q_85,usm_0.66_1.00_0.01,enc_avif,quality_auto/Untitled-28_edited.png" class="logo" alt="Logo" onerror="this.src='https://via.placeholder.com/200x80?text=Logo'"/>
    <h2>Your Personalized Connection Profile</h2>
    <div id="results" class="stack"></div>
    <div id="coupleResults" class="stack"></div>
    <p style="color:#A3A3A3; font-size:0.9rem; margin-top:10px;">HappyMarriageHappyLife.com</p>
  </div>

  <script>
    /* ===== Colors & Content ===== */
    const typeColors = {
      Spiritual:"#6A4C93", Emotional:"#FF7A70", Commitment:"#FFB347", Intellectual:"#4C6B9B",
      Affable:"#FFB6C1", Recreational:"#4DD2FF", Partnership:"#3CB371", Stability:"#FFD700",
      Creative:"#FF66CC", Conflict:"#FFA552", Physical:"#FF8C69", Sexual:"#E63946",
      ExtrovertedExpress:"#FFB347", ExtrovertedReceive:"#FFD580", ReflectiveExpress:"#6A4C93",
      ReflectiveReceive:"#A68CC2", SupportiveExpress:"#88C0D0", SupportiveReceive:"#B2DFDB",
      AffableExpress:"#4CAF50", AffableReceive:"#A3D977", StrongWilledExpress:"#E63946",
      StrongWilledReceive:"#FF7A70", SteadyConnector:"#4CAF50", ReassuranceSeeker:"#FFADAD",
      IndependentConnector:"#88C0D0", GuardedConnector:"#A5A5A5"
    };
    const typeColorsWithOpacity = {
      Spiritual:"rgba(106,76,147,0.08)", Emotional:"rgba(255,122,112,0.08)", Commitment:"rgba(255,179,71,0.08)",
      Intellectual:"rgba(76,107,155,0.08)", Affable:"rgba(255,182,193,0.08)", Recreational:"rgba(77,210,255,0.08)",
      Partnership:"rgba(60,179,113,0.08)", Stability:"rgba(255,215,0,0.08)", Creative:"rgba(255,102,204,0.08)",
      Conflict:"rgba(255,165,82,0.08)", Physical:"rgba(255,140,105,0.08)", Sexual:"rgba(230,57,70,0.08)",
      ExtrovertedExpress:"rgba(255,179,71,0.08)", ExtrovertedReceive:"rgba(255,213,128,0.08)",
      ReflectiveExpress:"rgba(106,76,147,0.08)", ReflectiveReceive:"rgba(166,140,194,0.08)",
      SupportiveExpress:"rgba(136,192,208,0.08)", SupportiveReceive:"rgba(178,223,219,0.08)",
      AffableExpress:"rgba(76,175,80,0.08)", AffableReceive:"rgba(163,217,119,0.08)",
      StrongWilledExpress:"rgba(230,57,70,0.08)", StrongWilledReceive:"rgba(255,122,112,0.08)",
      SteadyConnector:"rgba(76,175,80,0.08)", ReassuranceSeeker:"rgba(255,173,173,0.08)",
      IndependentConnector:"rgba(136,192,208,0.08)", GuardedConnector:"rgba(165,165,165,0.08)"
    };

    const intimacyDescriptions = {
      Spiritual:{desc:"You value a shared faith or sense of purpose, connecting through beliefs and values that guide your life together.",tip:"Engage in a weekly spiritual practice to deepen your bond."},
      Emotional:{desc:"You seek emotional safety and vulnerability, thriving when you feel deeply known and understood.",tip:"Schedule uninterrupted time for heartfelt conversation."},
      Commitment:{desc:"You prioritize trust and loyalty, finding security in a steadfast partnership.",tip:"Review shared goals and keep small promises."},
      Intellectual:{desc:"You connect through stimulating ideas and thoughtful discussions.",tip:"Read something together and discuss it."},
      Affable:{desc:"You cherish kindness, peace, and joy, building warmth through calm and caring moments.",tip:"Plan a relaxing, low-pressure evening."},
      Recreational:{desc:"You bond through shared activities and adventures.",tip:"Plan a small adventure or playful activity."},
      Partnership:{desc:"You value teamwork and collaboration.",tip:"Pick a small project to do together."},
      Stability:{desc:"You find unity through transparent planning of resources.",tip:"Hold a short planning check-in."},
      Creative:{desc:"You connect through imagination and collaboration.",tip:"Start a light creative task together."},
      Conflict:{desc:"You grow closer through respectful resolution.",tip:"Practice active listening in your next disagreement."},
      Physical:{desc:"You feel loved through non-sexual touch that fosters security.",tip:"Add consistent, warm daily touch."},
      Sexual:{desc:"You express intimacy through sexual connection.",tip:"Discuss desires and schedule protected time."}
    };

    const scriptures = {
      "Compassion and Care": "“Be completely humble and gentle; be patient, bearing with one another in love.” — Ephesians 4:2",
      "Social Engagement": "“Live in harmony with one another.” — Romans 12:16",
      "Decision-Making and Leadership": "“Plans fail for lack of counsel, but with many advisers they succeed.” — Proverbs 15:22",
      "Respect and Recognition": "“Be devoted to one another in love. Honor one another above yourselves.” — Romans 12:10",
      "30-Day Discussion & Strategy": "“And over all these virtues put on love, which binds them all together in perfect unity.” — Colossians 3:14",
      "Partner Alignment Discussion": "“Two are better than one… If either of them falls down, one can help the other up.” — Ecclesiastes 4:9–10"
    };

    const bondingInsights = {
      SteadyConnector:{desc:"You create a safe space for open communication, fostering resilience and mutual understanding.",challenges:"You may assume quick communication resolves all issues.",conflictStyle:"Seeks harmony; may avoid deeper issues.",tip:"Weekly check-ins where both share feelings."},
      ReassuranceSeeker:{desc:"You thrive on frequent affirmations and emotional vibrancy.",challenges:"Desire for validation may overwhelm your spouse.",conflictStyle:"May over-pursue reassurance, escalating tension.",tip:"Ask for a simple daily affirmation."},
      IndependentConnector:{desc:"Your steady presence brings calm and stability.",challenges:"Space can be perceived as distance.",conflictStyle:"May withdraw to avoid conflict.",tip:"Plan a quiet, no-pressure evening weekly."},
      GuardedConnector:{desc:"You build trust gradually, creating dependable bonds.",challenges:"Guardedness can slow emotional openness.",conflictStyle:"May assume negative intent and get defensive.",tip:"Adopt a small, daily trust-building ritual."}
    };

    const conflictStrategies = {
      SteadyConnector: {
        SteadyConnector: "Maintain open communication with regular check-ins.",
        ReassuranceSeeker: "Offer reassurance while setting clear boundaries.",
        IndependentConnector: "Balance space with structured discussions.",
        GuardedConnector: "Build trust with consistent, small gestures."
      },
      ReassuranceSeeker: {
        SteadyConnector: "Acknowledge their need for harmony with affirmations.",
        ReassuranceSeeker: "Take turns validating each other to avoid escalation.",
        IndependentConnector: "Provide reassurance before giving space.",
        GuardedConnector: "Be patient and offer gentle affirmations."
      },
      IndependentConnector: {
        SteadyConnector: "Respect their need for harmony while giving space.",
        ReassuranceSeeker: "Offer reassurance then allow time to process.",
        IndependentConnector: "Agree on clear times for discussion.",
        GuardedConnector: "Build trust with low-pressure interactions."
      },
      GuardedConnector: {
        SteadyConnector: "Engage slowly with consistent openness.",
        ReassuranceSeeker: "Offer small affirmations to build trust.",
        IndependentConnector: "Respect their space while showing reliability.",
        GuardedConnector: "Focus on gradual, mutual trust-building."
      }
    };

    const actionPlans = {
      Spiritual:{SteadyConnector:"Join a faith-based group and reflect weekly.",ReassuranceSeeker:"Daily shared prayer or affirmation.",IndependentConnector:"Quiet individual reflection, then share.",GuardedConnector:"Weekly short ritual (read/pray) to build trust."},
      Emotional:{SteadyConnector:"20-minute weekly heart-talk.",ReassuranceSeeker:"Request daily words of reassurance.",IndependentConnector:"Monthly deep talk to balance space.",GuardedConnector:"One vulnerable share daily."},
      Commitment:{SteadyConnector:"Monthly review of shared goals.",ReassuranceSeeker:"Weekly tangible commitment gesture.",IndependentConnector:"Quarterly goal-setting session.",GuardedConnector:"Daily mini-ritual of commitment."},
      Intellectual:{SteadyConnector:"Weekly article/book chat.",ReassuranceSeeker:"Share an idea daily.",IndependentConnector:"Read separately; discuss monthly.",GuardedConnector:"Low-pressure journal exchange."},
      Affable:{SteadyConnector:"Weekly quiet evening.",ReassuranceSeeker:"Daily kind gesture.",IndependentConnector:"Monthly relaxing outing.",GuardedConnector:"Daily small kindness."},
      Recreational:{SteadyConnector:"Weekly activity (walk/cook).",ReassuranceSeeker:"Regular shared adventures.",IndependentConnector:"Monthly group activity.",GuardedConnector:"Low-key weekly activity."},
      Partnership:{SteadyConnector:"Weekly joint project.",ReassuranceSeeker:"Regular collaboration on tasks.",IndependentConnector:"Monthly shared task.",GuardedConnector:"Small weekly task."},
      Stability:{SteadyConnector:"Weekly 10-min planning huddle.",ReassuranceSeeker:"Transparent updates each week.",IndependentConnector:"Monthly review.",GuardedConnector:"Weekly check-in for transparency."},
      Creative:{SteadyConnector:"Weekly creative micro-project.",ReassuranceSeeker:"Regular creative collab.",IndependentConnector:"Monthly creative night.",GuardedConnector:"Low-pressure weekly creative task."},
      Conflict:{SteadyConnector:"Weekly active-listening practice.",ReassuranceSeeker:"Ask for reassurance + slow down.",IndependentConnector:"Set space, then reconvene.",GuardedConnector:"Daily respectful dialogue habit."},
      Physical:{SteadyConnector:"Daily warm touch.",ReassuranceSeeker:"Frequent small gestures.",IndependentConnector:"Planned moments monthly.",GuardedConnector:"Daily micro-gestures."},
      Sexual:{SteadyConnector:"Weekly intimacy + dialogue.",ReassuranceSeeker:"Regular affirmation of passion.",IndependentConnector:"Monthly intimacy plan.",GuardedConnector:"Weekly desire conversation."}
    };

    const questions = [
      { q:"When your spouse is stressed, what's your first instinct?", opts:[
        { text:"Lighten the mood with fun or a distraction.", t:"Extroverted", i:"Recreational", style:"Recreational" },
        { text:"Take charge and solve the problem.", t:"StrongWilled", i:"Conflict", style:"Reflective" },
        { text:"Offer thoughtful advice or discuss the issue deeply.", t:"Reflective", i:"Intellectual", style:"Supportive" },
        { text:"Listen quietly and offer comfort.", t:"Affable", i:"Affable", style:"Emotional" },
        { text:"Help them quietly without being asked.", t:"Supportive", i:"Partnership", style:"Partnership" }
      ]},
      { q:"What's your ideal weekend plan?", opts:[
        { text:"Spontaneous and exciting activities.", t:"Extroverted", i:"Recreational", style:"Recreational" },
        { text:"Tackling a project or goal.", t:"StrongWilled", i:"Partnership", style:"Reflective" },
        { text:"Reading or working on a creative project.", t:"Reflective", i:"Creative", style:"Supportive" },
        { text:"Relaxing at home quietly.", t:"Affable", i:"Affable", style:"Emotional" },
        { text:"Helping family or serving others.", t:"Supportive", i:"Commitment", style:"Partnership" }
      ]},
      { q:"How do you respond to your spouse's sadness?", opts:[
        { text:"Try to make them smile.", t:"Extroverted", i:"Recreational", style:"Recreational" },
        { text:"Fix the cause of their sadness.", t:"StrongWilled", i:"Conflict", style:"Reflective" },
        { text:"Have a deep conversation about it.", t:"Reflective", i:"Intellectual", style:"Supportive" },
        { text:"Offer a hug and physical comfort.", t:"Affable", i:"Physical", style:"Emotional" },
        { text:"Perform a kind act to show care.", t:"Supportive", i:"Partnership", style:"Partnership" }
      ]},
      { q:"What's your role in group settings?", opts:[
        { text:"Engaging everyone with enthusiasm.", t:"Extroverted", i:"Recreational", style:"Recreational", domain:"Social" },
        { text:"Leading or organizing the group.", t:"StrongWilled", i:"Conflict", style:"Reflective", domain:"Social" },
        { text:"Listening and observing.", t:"Reflective", i:"Intellectual", style:"Supportive", domain:"Social" },
        { text:"Following the group's decisions.", t:"Affable", i:"Affable", style:"Emotional", domain:"Social" },
        { text:"Ensuring others feel supported.", t:"Supportive", i:"Partnership", style:"Partnership", domain:"Social" }
      ]},
      { q:"What's your ideal date night?", opts:[
        { text:"Fun and spontaneous.", t:"Extroverted", i:"Recreational", style:"Recreational" },
        { text:"Working on a shared goal.", t:"StrongWilled", i:"Commitment", style:"Reflective" },
        { text:"Deep, meaningful activity.", t:"Reflective", i:"Creative", style:"Supportive" },
        { text:"Low-key night in.", t:"Affable", i:"Affable", style:"Emotional" },
        { text:"Serving or honoring my spouse.", t:"Supportive", i:"Partnership", style:"Partnership" }
      ]},
      { q:"How do you approach decisions?", opts:[
        { text:"Go with what's fun.", t:"Extroverted", i:"Emotional", style:"Recreational", domain:"Decision" },
        { text:"Make quick, decisive choices.", t:"StrongWilled", i:"Conflict", style:"Reflective", domain:"Decision" },
        { text:"Analyze all details.", t:"Reflective", i:"Intellectual", style:"Supportive", domain:"Decision" },
        { text:"Keep peace and go with the flow.", t:"Affable", i:"Affable", style:"Emotional", domain:"Decision" },
        { text:"Consider others' wants.", t:"Supportive", i:"Commitment", style:"Partnership", domain:"Decision" }
      ]},
      { q:"How do you react during conflict?", opts:[
        { text:"Use humor to diffuse tension.", t:"Extroverted", i:"Emotional", style:"Recreational", b:"SteadyConnector" },
        { text:"Push for a resolution.", t:"StrongWilled", i:"Conflict", style:"Reflective", b:"ReassuranceSeeker" },
        { text:"Retreat to think.", t:"Reflective", i:"Intellectual", style:"Supportive", b:"IndependentConnector" },
        { text:"Stay calm to avoid escalation.", t:"Affable", i:"Affable", style:"Emotional", b:"IndependentConnector" },
        { text:"Concede to end conflict.", t:"Supportive", i:"Commitment", style:"Partnership", b:"GuardedConnector" }
      ]},
      { q:"How do you express affection?", opts:[
        { text:"Fun words and excitement.", t:"Extroverted", i:"Emotional", style:"Recreational", domain:"Affection" },
        { text:"Doing tasks to help.", t:"StrongWilled", i:"Partnership", style:"Reflective", domain:"Affection" },
        { text:"Meaningful conversations.", t:"Reflective", i:"Creative", style:"Supportive", domain:"Affection" },
        { text:"Physical touch or presence.", t:"Affable", i:"Physical", style:"Emotional", domain:"Affection" },
        { text:"Serving quietly.", t:"Supportive", i:"Partnership", style:"Partnership", domain:"Affection" }
      ]},
      { q:"How do you prioritize your time or money?", opts:[
        { text:"Spend on fun experiences.", t:"Extroverted", i:"Recreational", style:"Recreational" },
        { text:"Invest in goals or efficiency.", t:"StrongWilled", i:"Stability", style:"Reflective" },
        { text:"Allocate thoughtfully after planning.", t:"Reflective", i:"Stability", style:"Supportive" },
        { text:"Use flexibly to keep peace.", t:"Affable", i:"Affable", style:"Emotional" },
        { text:"Share generously with others.", t:"Supportive", i:"Partnership", style:"Partnership" }
      ]},
      { q:"How do you feel when unappreciated?", opts:[
        { text:"Laugh it off.", t:"Extroverted", i:"Emotional", style:"Recreational", b:"SteadyConnector" },
        { text:"Remind them of my effort.", t:"StrongWilled", i:"Commitment", style:"Reflective", b:"ReassuranceSeeker" },
        { text:"Feel overlooked.", t:"Reflective", i:"Intellectual", style:"Supportive", b:"IndependentConnector" },
        { text:"Let it go.", t:"Affable", i:"Affable", style:"Emotional", b:"IndependentConnector" },
        { text:"Feel deeply hurt.", t:"Supportive", i:"Commitment", style:"Partnership", b:"GuardedConnector" }
      ]},
      { q:"Do you feel your opinions are respected?", opts:[
        { text:"Strongly Agree", rr:3 },{ text:" Agree", rr:2 },{ text:"Somewhat Agree", rr:1 },{ text:"Disagree", rr:0 },{ text:"Strongly Disagree", rr:0 }
      ]},
      { q:"Are you and your spouse aligned on values?", opts:[
        { text:"Strongly Agree", rr:3 },{ text:" Agree", rr:2 },{ text:"Somewhat Agree", rr:1 },{ text:"Disagree", rr:0 },{ text:"Strongly Disagree", rr:0 }
      ]}
    ];

    /* ===== State ===== */
    const $ = id => document.getElementById(id);
    let mode = "individual";
    let currentPartnerIndex = 0;
    let partnerNames = ["You", "Partner"];
    const partnerProfiles = [];
    let index = 0, tempScores = {}, socialTempScores = {}, decisionTempScores = {}, intimacyScores = {}, bondingScores = {}, respectRecognitionScore = 0, answers = [];

    function resetScores() {
      tempScores = { Extroverted:0, StrongWilled:0, Reflective:0, Affable:0, Supportive:0 };
      socialTempScores = { Extroverted:0, StrongWilled:0, Reflective:0, Affable:0, Supportive:0 };
      decisionTempScores = { Extroverted:0, StrongWilled:0, Reflective:0, Affable:0, Supportive:0 };
      intimacyScores = {}; Object.keys(intimacyDescriptions).forEach(k=>intimacyScores[k]=0);
      bondingScores = {}; respectRecognitionScore = 0; answers = []; index = 0;
    }

    function normalizeIntimacyScores() {
      const questionCounts = {};
      Object.keys(intimacyDescriptions).forEach(k => questionCounts[k] = 0);
      questions.forEach(q => {
        q.opts.forEach(o => {
          if (o.i) questionCounts[o.i] = (questionCounts[o.i] || 0) + 1;
        });
      });
      const normalized = {};
      Object.keys(intimacyScores).forEach(type => {
        normalized[type] = questionCounts[type] ? (intimacyScores[type] / questionCounts[type]) * 3 : 0;
      });
      return normalized;
    }

    function getAffectionPreferences() {
      const highestExpressed = Object.entries(tempScores).sort((a,b)=>b[1]-a[1])[0]?.[0] || 'Supportive';
      const prefs = {
        Extroverted:{expressed:"You express love in a recreational style, using fun, lighthearted interactions to create joy.", desired:"You feel loved when your spouse connects in a recreational style."},
        StrongWilled:{expressed:"You express love in a reflective style by solving problems/helping.", desired:"You feel loved when supported in a reflective style."},
        Reflective:{expressed:"You express love in a supportive style through deep, meaningful exchanges.", desired:"You feel loved when offered meaningful connection in a supportive style."},
        Affable:{expressed:"You express love in an emotional style with warmth and gentle presence.", desired:"You feel loved through peaceful companionship in an emotional style."},
        Supportive:{expressed:"You express love in a partnership style through shared goals and help.", desired:"You feel loved through intentional collaboration in a partnership style."}
      };
      return { expressed: prefs[highestExpressed].expressed, expressedType: highestExpressed + "Express", desired: prefs[highestExpressed].desired, desiredType: highestExpressed + "Receive" };
    }

    function getSocialPreferences() {
      const highest = Object.entries(socialTempScores).sort((a,b)=>b[1]-a[1])[0]?.[0] || 'Supportive';
      const d = {
        Extroverted:"You bring energy and enthusiasm to social settings.",
        StrongWilled:"You lead and organize with confidence.",
        Reflective:"You prefer deep, thoughtful conversations.",
        Affable:"You enjoy calm, low-key interactions.",
        Supportive:"You support others quietly, fostering inclusion."
      };
      return d[highest] || "You flex between engagement and solitude as needed.";
    }

    function getDecisionLeadershipStyle() {
      const highest = Object.entries(decisionTempScores).sort((a,b)=>b[1]-a[1])[0]?.[0] || 'Supportive';
      const s = {
        Extroverted:"You decide with enthusiasm, prioritizing enjoyment.",
        StrongWilled:"You decide decisively with clear goals.",
        Reflective:"You analyze thoroughly before deciding.",
        Affable:"You choose harmony and peace in decisions.",
        Supportive:"You collaborate and support shared choices."
      };
      return s[highest] || "You balance leadership and collaboration in decisions.";
    }

    function getBondingStyle() {
      return Object.entries(bondingScores).sort((a,b)=>b[1]-a[1])[0]?.[0] || "SteadyConnector";
    }

    function respectSummary(score) {
      return score >= 5 ? "You feel strongly respected and aligned—solid ground for intimacy."
           : score >= 3 ? "Moderate respect/alignment with room to deepen understanding."
                        : "You may desire more recognition and alignment to strengthen connection.";
    }

    /* ===== UI wiring ===== */
    $('mode').addEventListener('change', () => {
      mode = $('mode').value;
      $('coupleFields').classList.toggle('hidden', mode !== 'couple');
    });

    $('startQuizBtn').addEventListener('click', () => {
      mode = $('mode').value;
      if (mode === 'couple') {
        const p1 = $('p1Name').value.trim().replace(/[<>]/g, '');
        const p2 = $('p2Name').value.trim().replace(/[<>]/g, '');
        if (!p1 || !p2) { alert('Please enter both partner names.'); return; }
        if (p1.length > 50 || p2.length > 50) { alert('Names must be 50 characters or less.'); return; }
        partnerNames = [p1.substring(0, 50), p2.substring(0, 50)];
      } else {
        partnerNames = ['You', 'Partner'];
      }
      currentPartnerIndex = 0;
      startPartnerRun();
    });

    $('backBtn').addEventListener('click', () => goBack());

    function startPartnerRun() {
      resetScores();
      $('introPage').classList.add('hidden');
      $('resultPage').classList.add('hidden');
      $('quizPage').classList.remove('hidden');
      $('quizHeading').textContent = mode === 'couple' ? `Intimacy Profile Assessment — ${partnerNames[currentPartnerIndex]}` : 'Intimacy Profile Assessment';
      showQuestion();
    }

    function showQuestion() {
      const q = questions[index];
      const progress = $('progress');
      const progressBar = $('progressBar');
      const container = $('questionContainer');
      progress.textContent = `Question ${index + 1} of ${questions.length}`;
      progressBar.style.width = `${((index + 1) / questions.length) * 100}%`;
      let html = `<h3 id="questionLabel">${q.q}</h3>`;
      q.opts.forEach((o, i) => {
        html += `<button class="answer-btn" role="radio" aria-checked="false" aria-labelledby="questionLabel option${i}" id="option${i}" data-i="${i}">${o.text}</button>`;
      });
      container.innerHTML = html;
      container.querySelectorAll('.answer-btn').forEach(btn => {
        btn.addEventListener('click', e => {
          container.querySelectorAll('.answer-btn').forEach(b => b.setAttribute('aria-checked', 'false'));
          e.currentTarget.setAttribute('aria-checked', 'true');
          e.currentTarget.classList.add('selected');
          setTimeout(() => e.currentTarget.classList.remove('selected'), 200);
          recordAnswer(Number(e.currentTarget.dataset.i));
        });
      });
      $('backBtn').classList.toggle('hidden', index === 0);
    }

    function recordAnswer(i) {
      const o = questions[index].opts[i];
      answers[index] = i;

      if (o.t) {
        if (o.domain === "Social") socialTempScores[o.t]++;
        else if (o.domain === "Decision") decisionTempScores[o.t]++;
        else tempScores[o.t]++;
      }
      if (o.i) intimacyScores[o.i] = (intimacyScores[o.i] || 0) + 1;
      if (o.b) bondingScores[o.b] = (bondingScores[o.b] || 0) + 1;
      if (o.rr !== undefined) respectRecognitionScore += o.rr;

      index++;
      if (index < questions.length) showQuestion(); else finishPartnerRun();
    }

    function goBack() {
      if (index === 0) return;
      index--;
      const prev = answers[index];
      if (prev != null) {
        const o = questions[index].opts[prev];
        if (o.t) {
          if (o.domain === "Social") socialTempScores[o.t]--;
          else if (o.domain === "Decision") decisionTempScores[o.t]--;
          else tempScores[o.t]--;
        }
        if (o.i) intimacyScores[o.i]--;
        if (o.b) bondingScores[o.b]--;
        if (o.rr !== undefined) respectRecognitionScore -= o.rr;
        answers[index] = undefined;
      }
      showQuestion();
    }

    function computeProfile() {
      const normalized = normalizeIntimacyScores();
      const sorted = Object.entries(normalized).sort((a,b)=>b[1]-a[1]);
      const priority = sorted.slice(0,4);
      const progress = sorted.slice(4,8);
      const presence = sorted.slice(8,12);
      const affection = getAffectionPreferences();
      const social = getSocialPreferences();
      const decision = getDecisionLeadershipStyle();
      const bondingKey = getBondingStyle();
      const bondingLabel = bondingKey.replace(/([a-z])([A-Z])/g,'$1 $2');
      const respectText = respectSummary(respectRecognitionScore);
      return { normalized, sorted, priority, progress, presence, affection, social, decision, bondingKey, bondingLabel, respectText };
    }

    function finishPartnerRun() {
      const profile = computeProfile();
      partnerProfiles[currentPartnerIndex] = profile;

      if (mode === 'couple' && currentPartnerIndex === 0) {
        $('quizPage').classList.add('hidden');
        $('introPage').classList.remove('hidden');
        $('mode').value = 'couple';
        $('coupleFields').classList.remove('hidden');
        $('startQuizBtn').textContent = `Start ${partnerNames[1]}'s Assessment`;
        currentPartnerIndex = 1;
        $('p1Name').setAttribute('disabled','true');
        $('p2Name').setAttribute('disabled','true');
        $('startQuizBtn').onclick = () => startPartnerRun();
      } else {
        $('quizPage').classList.add('hidden');
        $('resultPage').classList.remove('hidden');
        renderResults();
      }
    }

    /* ===== Helpers to render sections ===== */
    function scriptureLine(title) {
      const verse = scriptures[title];
      return verse ? `<div class="scripture-line">${verse}</div>` : '';
    }

    function block(type, extraHtml = '') {
      return `
        <div class="result-block" style="border-left-color:${typeColors[type]}; background:${typeColorsWithOpacity[type]};">
          ${extraHtml}
        </div>
      `;
    }

    function sectionHTML(title, text, items, prompts = []) {
      return `
        <div>
          <div class="subsection-divider"></div>
          <h4 class="subsection-title">${title}</h4>
          ${scriptureLine(title)}
          <p class="intro-text">${text}</p>
          ${items.map(([type]) => `
            <div class="result-block" style="border-left:8px solid ${typeColors[type]}; background-color:${typeColorsWithOpacity[type]};">
              <strong>${type}</strong> – ${intimacyDescriptions[type].desc}
            </div>`).join('')}
          ${prompts.length ? `
            <div class="discussion-prompts">
              <h5>Discussion Prompts</h5>
              <ul>
                ${prompts.map(p => `<li>${p}</li>`).join('')}
              </ul>
            </div>` : ``}
        </div>
      `;
    }

    function renderSingleProfile(p, nameLabel) {
      const { priority, progress, presence, affection, social, decision, bondingKey, bondingLabel, respectText } = p;
      const sec2Prompts = [
        "Steward your strengths—use them intentionally twice this week.",
        "Choose one growth area to practice once this week.",
        "Pick one untapped opportunity to experiment with together."
      ];

      return `
        <div class="section-divider"></div>
        <div class="partner-name">${nameLabel}</div>
        ${sectionHTML(
          "Your Intimacy Type Preferences",
          "Your results highlight how you naturally connect, where growth is possible, and new ways to bond.",
          [], []
        )}
        ${sectionHTML(
          "Core Connection Strengths",
          "These top four intimacy types are where you naturally excel.",
          priority, sec2Prompts
        )}
        ${sectionHTML(
          "Areas for Growth",
          "These middle four types will improve with a little intentional focus.",
          progress
        )}
        ${sectionHTML(
          "Untapped Opportunities",
          "These lower four types may be overlooked—trying one can open a new door.",
          presence
        )}
        <div class="subsection-divider"></div>
        <h4 class="subsection-title">Compassion and Care</h4>
        ${scriptureLine("Compassion and Care")}
        ${block(affection.expressedType, `
          <strong>How You Express Love:</strong> ${affection.expressed}
        `)}
        ${block(affection.desiredType, `
          <strong>How You Feel Loved:</strong> ${affection.desired}
        `)}
        <div class="discussion-prompts">
          <h5>Discussion Prompts</h5>
          <ul>
            <li>Which expression feels most natural to you? Which request helps you feel most loved?</li>
            <li>What small practice could your spouse try this week to speak your “love language” better?</li>
          </ul>
        </div>
        <h4 class="subsection-title">Social Engagement</h4>
        ${scriptureLine("Social Engagement")}
        ${block('ExtrovertedExpress', `<strong>Your Social Style:</strong> ${social}`)}
        <div class="discussion-prompts">
          <h5>Discussion Prompts</h5>
          <ul>
            <li>Where do your social needs align or differ? Plan one event that fits both.</li>
          </ul>
        </div>
        <h4 class="subsection-title">Decision-Making and Leadership</h4>
        ${scriptureLine("Decision-Making and Leadership")}
        ${block('ReflectiveExpress', `<strong>Your Decision Style:</strong> ${decision}`)}
        <div class="discussion-prompts">
          <h5>Discussion Prompts</h5>
          <ul>
            <li>How can your decision styles complement each other this month?</li>
          </ul>
        </div>
        <h4 class="subsection-title">Respect and Recognition</h4>
        ${scriptureLine("Respect and Recognition")}
        ${block('Spiritual', `<strong>Your Alignment:</strong> ${respectText}`)}
        <div class="discussion-prompts">
          <h5>Discussion Prompts</h5>
          <ul>
            <li>What specific actions help you feel honored and recognized?</li>
          </ul>
        </div>
        ${block(bondingKey, `
          <strong>Connection Pattern:</strong> ${bondingLabel}<br/>
          <strong>Strengths:</strong> ${bondingInsights[bondingKey].desc}<br/>
          <strong>Challenges:</strong> ${bondingInsights[bondingKey].challenges}<br/>
          <strong>Conflict Style:</strong> ${bondingInsights[bondingKey].conflictStyle}
        `)}
      `;
    }

    function renderCoupleComparison(p1, p2) {
      const top1 = p1.priority.map(x=>x[0]);
      const top2 = p2.priority.map(x=>x[0]);
      const overlap = top1.filter(t => top2.includes(t));
      const only1 = top1.filter(t => !overlap.includes(t));
      const only2 = top2.filter(t => !overlap.includes(t));
      const want1 = p1.affection.desiredType.replace(/(Express|Receive)$/,'');
      const want2 = p2.affection.desiredType.replace(/(Express|Receive)$/,'');
      const express1 = p1.affection.expressedType.replace(/(Express|Receive)$/,'');
      const express2 = p2.affection.expressedType.replace(/(Express|Receive)$/,'');
      const youFillThem = express1 === want2
        ? `${partnerNames[0]}'s natural expression maps to ${partnerNames[1]}'s desired style. Great fit!`
        : `${partnerNames[0]}'s expression differs from ${partnerNames[1]}'s desired style. Add a simple weekly practice in ${want2}.`;
      const theyFillYou = express2 === want1
        ? `${partnerNames[1]}'s natural expression maps to ${partnerNames[0]}'s desired style. Great fit!`
        : `${partnerNames[1]}'s expression differs from ${partnerNames[0]}'s desired style. Add a weekly practice in ${want1}.`;
      const strat12 = (conflictStrategies[p1.bondingKey]||{})[p2.bondingKey] || "Use weekly check-ins and reflective listening.";
      const strat21 = (conflictStrategies[p2.bondingKey]||{})[p1.bondingKey] || "Use weekly check-ins and reflective listening.";

      return `
        <div class="section-divider"></div>
        <h3 class="section-title">Couple Comparison</h3>
        <div class="two-col">
          <div>
            <div class="partner-name">${partnerNames[0]}</div>
            ${block(p1.priority[0][0], `<strong>Top Intimacy:</strong> ${p1.priority[0][0]}`)}
            ${block(p1.affection.expressedType, `<strong>Expresses Love:</strong> ${p1.affection.expressed}`)}
            ${block(p1.affection.desiredType, `<strong>Feels Loved By:</strong> ${p1.affection.desired}`)}
            ${block(p1.bondingKey, `<strong>Connection Pattern:</strong> ${p1.bondingLabel}`)}
          </div>
          <div>
            <div class="partner-name">${partnerNames[1]}</div>
            ${block(p2.priority[0][0], `<strong>Top Intimacy:</strong> ${p2.priority[0][0]}`)}
            ${block(p2.affection.expressedType, `<strong>Expresses Love:</strong> ${p2.affection.expressed}`)}
            ${block(p2.affection.desiredType, `<strong>Feels Loved By:</strong> ${p2.affection.desired}`)}
            ${block(p2.bondingKey, `<strong>Connection Pattern:</strong> ${p2.bondingLabel}`)}
          </div>
        </div>
        <div class="subsection-divider"></div>
        <h4 class="subsection-title">Top-4 Intimacy: Overlap & Differences</h4>
        <div class="table-responsive">
          <table>
            <tr><th>Overlap</th><th>Only ${partnerNames[0]}</th><th>Only ${partnerNames[1]}</th></tr>
            <tr>
              <td>${overlap.length ? overlap.join(', ') : 'None'}</td>
              <td>${only1.length ? only1.join(', ') : 'None'}</td>
              <td>${only2.length ? only2.join(', ') : 'None'}</td>
            </tr>
          </table>
        </div>
        <div class="discussion-prompts">
          <h5>Discussion Prompts</h5>
          <ul>
            <li>Plan one ‘overlap’ date this week; choose one “only” from each partner next week.</li>
          </ul>
        </div>
        <div class="subsection-divider"></div>
        <h4 class="subsection-title">Affection Alignment</h4>
        <div class="two-col">
          ${block('AffableExpress', `<strong>${partnerNames[0]} → ${partnerNames[1]}:</strong> ${youFillThem}`)}
          ${block('SupportiveExpress', `<strong>${partnerNames[1]} → ${partnerNames[0]}:</strong> ${theyFillYou}`)}
        </div>
        <div class="discussion-prompts">
          <h5>Discussion Prompts</h5>
          <ul>
            <li>What’s one small weekly practice each of you will do to meet the other’s desired style?</li>
          </ul>
        </div>
        <div class="subsection-divider"></div>
        <h4 class="subsection-title">Personalized Conflict Resolution Strategies</h4>
        <div class="table-responsive">
          <table>
            <tr><th>Partner</th><th>Pattern</th><th>Strategy With Other</th></tr>
            <tr><td>${partnerNames[0]}</td><td>${p1.bondingLabel}</td><td>${strat12}</td></tr>
            <tr><td>${partnerNames[1]}</td><td>${p2.bondingLabel}</td><td>${strat21}</td></tr>
          </table>
        </div>
      `;
    }

    function renderResults() {
      const results = $('results');
      const coupleResults = $('coupleResults');
      results.innerHTML = '<button class="btn" id="restartQuizBtn">Restart Assessment</button>';
      results.innerHTML += `<canvas id="intimacyChart" style="max-width: 500px; margin: 20px auto;"></canvas>`;
      coupleResults.innerHTML = '';

      if (mode === 'individual') {
        const p = partnerProfiles[0];
        results.innerHTML += renderSingleProfile(p, partnerNames[0]);
        const title5 = "30-Day Discussion & Strategy";
        results.innerHTML += `
          <div class="section-divider"></div>
          <h3 class="section-title">${title5}</h3>
          ${scriptureLine(title5)}
          <p class="intro-text">
            Use your top intimacy (${p.priority[0][0]}) and connection pattern (${p.bondingLabel}) to co-create a plan.
          </p>
          <div class="discussion-prompts">
            <h5>Discussion Prompts</h5>
            <ul>
              <li>What is one small, realistic step this week that fits ${p.priority[0][0]}?</li>
              <li>How will we support each other given our pattern (${p.bondingLabel})?</li>
              <li>When will we check in (day/time) to review progress?</li>
            </ul>
          </div>
        `;
        const title6 = "Partner Alignment Discussion";
        results.innerHTML += `
          <div class="section-divider"></div>
          <h3 class="section-title">${title6}</h3>
          ${scriptureLine(title6)}
          <p class="intro-text">If you’re taking this with your spouse, use these to align and plan.</p>
          <div class="discussion-prompts">
            <h5>Discussion Prompts</h5>
            <ul>
              <li>Where do we naturally overlap? How can we lean into that this week?</li>
              <li>Which differences can we celebrate and take turns practicing?</li>
              <li>What one shared goal will we commit to over the next 30 days?</li>
            </ul>
          </div>
        `;
      } else {
        const p1 = partnerProfiles[0];
        const p2 = partnerProfiles[1];
        results.innerHTML += renderSingleProfile(p1, partnerNames[0]) + renderSingleProfile(p2, partnerNames[1]);
        coupleResults.innerHTML = renderCoupleComparison(p1, p2);
        const title5 = "30-Day Discussion & Strategy";
        coupleResults.innerHTML += `
          <div class="section-divider"></div>
          <h3 class="section-title">${title5}</h3>
          ${scriptureLine(title5)}
          <p class="intro-text">
            Build a 30-day plan that honors ${partnerNames[0]}'s top intimacy (${p1.priority[0][0]}) and ${partnerNames[1]}'s top intimacy (${p2.priority[0][0]}).
          </p>
          <div class="discussion-prompts">
            <h5>Discussion Prompts</h5>
            <ul>
              <li>What one shared practice fits both of our top intimacies?</li>
              <li>What’s one weekly action each of us will take to meet the other’s desired affection style?</li>
              <li>When will we check in, and how will we celebrate progress?</li>
            </ul>
          </div>
        `;
        const title6 = "Partner Alignment Discussion";
        coupleResults.innerHTML += `
          <div class="section-divider"></div>
          <h3 class="section-title">${title6}</h3>
          ${scriptureLine(title6)}
          <p class="intro-text">Use overlap and differences to design a rhythm that works for both.</p>
          <div class="discussion-prompts">
            <h5>Discussion Prompts</h5>
            <ul>
              <li>Choose one ‘overlap’ activity for this week.</li>
              <li>Pick one “only ${partnerNames[0]}” and one “only ${partnerNames[1]}” activity for alternating weeks.</li>
              <li>Agree on a quick weekly check-in (time + 2 questions) to adjust your plan.</li>
            </ul>
          </div>
        `;
      }

      // Render chart
      const ctx = document.getElementById('intimacyChart').getContext('2d');
      new Chart(ctx, {
        type: 'radar',
        data: {
          labels: Object.keys(intimacyDescriptions),
          datasets: partnerProfiles.map((p, i) => ({
            label: partnerNames[i],
            data: Object.values(p.normalized),
            backgroundColor: i === 0 ? 'rgba(77, 157, 224, 0.2)' : 'rgba(255, 77, 77, 0.2)',
            borderColor: i === 0 ? '#4D9DE0' : '#FF4D4D',
            borderWidth: 2
          }))
        },
        options: {
          scales: {
            r: {
              beginAtZero: true,
              max: 3,
              ticks: { stepSize: 1 }
            }
          },
          plugins: {
            legend: { position: 'top' }
          }
        }
      });

      $('restartQuizBtn').addEventListener('click', () => {
        partnerProfiles.length = 0;
        currentPartnerIndex = 0;
        resetScores();
        $('resultPage').classList.add('hidden');
        $('quizPage').classList.add('hidden');
        $('introPage').classList.remove('hidden');
        $('p1Name').removeAttribute('disabled');
        $('p2Name').removeAttribute('disabled');
        $('startQuizBtn').textContent = 'Start Assessment';
      });
    }
  </script>
</body>
</html>
