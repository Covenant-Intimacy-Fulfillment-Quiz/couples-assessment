<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Marriage Connection Assessment</title>

  <!-- Minimal debug: surface first JS error -->
  <script>
    window.addEventListener('error', function(e){
      alert('JS error: ' + (e && e.message ? e.message : e));
    });
  </script>

  <!-- (Optional) Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500&family=Open+Sans:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root{ --brand:#4D9DE0; --brand-2:#3A7FBF; --bg:#FFF9F2; --ink:#1A3C5E; --accent:#FF4D4D; --muted:#A3A3A3; }
    *{ box-sizing:border-box }
    body{ font-family:Arial, sans-serif; background:var(--bg); color:var(--ink); max-width:900px; margin:auto; padding:20px; }
    h1,h2,h3,h4{ text-align:center; line-height:1.3; }
    .card{ background:#fff; border:2px solid var(--brand); border-radius:12px; padding:25px; box-shadow:0 8px 25px rgba(0,0,0,.08); margin:20px auto; max-width:750px; text-align:center; }
    .btn,.answer-btn{ background:var(--brand); color:#fff; font-weight:bold; border:none; border-radius:8px; padding:15px 25px; cursor:pointer; margin:12px auto; display:block; width:100%; max-width:500px; text-align:center; touch-action:manipulation; }
    .btn:hover,.answer-btn:hover{ background:var(--brand-2); }
    .answer-btn.selected{ background:var(--brand-2); transform:scale(.98); transition:all .2s ease; }
    .hidden{ display:none; }
    .progress-bar-container{ width:100%; max-width:500px; height:10px; background:#e0e0e0; border-radius:5px; margin:10px auto; }
    .progress-bar{ height:100%; background:var(--accent); border-radius:5px; transition:width .3s ease; }
    .logo{ display:block; margin:0 auto 15px; max-width:200px; }
    .question-box{ background:#fff; border:1px solid var(--brand); border-radius:8px; padding:20px; margin:15px auto; max-width:700px; text-align:left; }
    .intro-text{ margin-bottom:10px; line-height:1.3; text-align:left; }
    .intro-text p{ margin-bottom:12pt; }

    /* Results */
    #resultPage{ line-height:1.3; }
    .section-title{ color:var(--ink); font-family:'Open Sans',sans-serif; font-size:16pt; font-weight:700; text-align:center; margin-bottom:10px; }
    .subsection-title{ color:var(--ink); font-family:'Roboto',sans-serif; font-size:14pt; font-weight:600; text-align:center; margin:15px 0 6px; }
    .scripture-line{ font-style:italic; text-align:center; margin:0 0 10px; }
    .section-divider{ height:1pt; background:var(--accent); width:100%; max-width:750px; margin:25pt auto; }
    .subsection-divider{ height:1pt; background:rgba(77,157,224,.5); width:100%; max-width:750px; margin:15pt auto; }
    .result-block{ margin-bottom:16px; page-break-inside:avoid; padding:20px; border-left:8px solid; border-radius:8px; background:#fff; opacity:0; transform:translateY(10px); animation:fadeIn .5s ease forwards; text-align:left; }
    @keyframes fadeIn{ to{ opacity:1; transform:translateY(0) } }
    .results-list{ list-style-position:outside; margin-left:20px; text-align:left; line-height:1.3; }
    .results-list li{ margin-bottom:8px; }
    .discussion-prompts{ margin:12pt 0; text-align:left; }
    .discussion-prompts h5{ margin:0 0 6px; font-size:1rem; }
    .discussion-prompts ul{ margin:0; padding-left:18px; }
    .two-col{ display:grid; grid-template-columns:1fr 1fr; gap:16px; }
    .stack{ display:grid; gap:12px; }
    .partner-name{ color:var(--accent); font-family:'Open Sans',sans-serif; font-size:16pt; font-weight:700; text-align:center; margin:10px 0; border-bottom:2px solid var(--brand); padding-bottom:5px; }
    .table-responsive{ width:100%; overflow-x:auto; }
    table{ width:100%; border-collapse:collapse; margin:20px 0; }
    th,td{ border:1px solid #e0e0e0; padding:10px; text-align:left; vertical-align:top; }
    th{ background:var(--brand); color:#fff; }
    .name-inputs{ display:grid; gap:10px; justify-items:center; margin-top:10px; }
    .name-inputs input,.name-inputs select{ padding:10px; border:1px solid var(--brand); border-radius:8px; width:100%; max-width:320px; }
    .banner{ background:#eaf4ff; border-left:6px solid var(--brand); padding:12px; border-radius:8px; margin:10px 0 0; text-align:left;}
    @media (max-width:700px){ .two-col{ grid-template-columns:1fr } .btn,.answer-btn{ max-width:100% } }
  </style>
</head>
<body>
  <!-- Intro Page -->
  <div id="introPage" class="card">
    <img src="https://via.placeholder.com/200x80?text=Logo" class="logo" alt="Logo"/>
    <h1>Discover Your Marriage Connection Profile</h1>
    <div class="intro-text">
      <p>Take the assessment as an individual or as a couple. In Couple Mode, you’ll see a side-by-side comparison with personalized recommendations.</p>
    </div>
    <div class="name-inputs">
      <label for="mode">Mode</label>
      <select id="mode">
        <option value="individual">Individual</option>
        <option value="couple">Couple</option>
      </select>
      <div id="coupleFields" class="hidden" style="width:100%; max-width:340px;">
        <input id="p1Name" type="text" placeholder="Partner 1 Name" />
        <input id="p2Name" type="text" placeholder="Partner 2 Name" />
      </div>
    </div>
    <div style="display:flex; justify-content:center;">
      <button id="startQuizBtn" class="btn" style="max-width:250px;">Start Assessment</button>
    </div>
    <p style="color:var(--muted); font-size:0.9rem; margin-top:10px;">HappyMarriageHappyLife.com</p>
  </div>

  <!-- Quiz Page -->
  <div id="quizPage" class="card hidden">
    <h2 id="quizHeading">Intimacy Profile Assessment</h2>
    <div class="progress-bar-container"><div class="progress-bar" id="progressBar"></div></div>
    <div class="progress" id="progress"></div>
    <div class="question-box" id="questionContainer" role="radiogroup"></div>
    <button class="btn hidden" id="backBtn">Previous Question</button>
    <p style="color:var(--muted); font-size:0.9rem; margin-top:10px;">HappyMarriageHappyLife.com</p>
  </div>

  <!-- Results Page -->
  <div id="resultPage" class="card hidden">
    <img src="https://via.placeholder.com/200x80?text=Logo" class="logo" alt="Logo"/>
    <h2>Your Personalized Connection Profile</h2>
    <div id="results" class="stack"></div>
    <div id="coupleResults" class="stack"></div>
    <div id="afterP1Banner" class="banner hidden">
      <strong>Want the couple comparison?</strong>
      <div style="display:flex; gap:8px; margin-top:8px; flex-wrap:wrap;">
        <button id="startP2Btn" class="btn" style="max-width:260px;">Add Partner 2 Now</button>
        <button id="keepSoloBtn" class="btn btn-secondary" style="max-width:260px; background:#e7f1fb; color:var(--ink); border:1px solid #cfe3f8;">Keep Solo Results</button>
      </div>
    </div>
    <p style="color:var(--muted); font-size:0.9rem; margin-top:10px;">HappyMarriageHappyLife.com</p>
  </div>

  <script>
    /* ========= Palette & Copy ========= */
    var typeColors = {
      Spiritual:"#6A4C93", Emotional:"#FF7A70", Commitment:"#FFB347", Intellectual:"#4C6B9B",
      Affable:"#FFB6C1", Recreational:"#4DD2FF", Partnership:"#3CB371", Stability:"#FFD700",
      Creative:"#FF66CC", Conflict:"#FFA552", Physical:"#FF8C69", Sexual:"#E63946",
      ExtrovertedExpress:"#FFB347", ExtrovertedReceive:"#FFD580", ReflectiveExpress:"#6A4C93",
      ReflectiveReceive:"#A68CC2", SupportiveExpress:"#88C0D0", SupportiveReceive:"#B2DFDB",
      AffableExpress:"#4CAF50", AffableReceive:"#A3D977", StrongWilledExpress:"#E63946",
      StrongWilledReceive:"#FF7A70", SteadyConnector:"#4CAF50", ReassuranceSeeker:"#FFADAD",
      IndependentConnector:"#88C0D0", GuardedConnector:"#A5A5A5"
    };
    var typeColorsWithOpacity = {
      Spiritual:"rgba(106,76,147,0.08)", Emotional:"rgba(255,122,112,0.08)", Commitment:"rgba(255,179,71,0.08)",
      Intellectual:"rgba(76,107,155,0.08)", Affable:"rgba(255,182,193,0.08)", Recreational:"rgba(77,210,255,0.08)",
      Partnership:"rgba(60,179,113,0.08)", Stability:"rgba(255,215,0,0.08)", Creative:"rgba(255,102,204,0.08)",
      Conflict:"rgba(255,165,82,0.08)", Physical:"rgba(255,140,105,0.08)", Sexual:"rgba(230,57,70,0.08)",
      ExtrovertedExpress:"rgba(255,179,71,0.08)", ExtrovertedReceive:"rgba(255,213,128,0.08)",
      ReflectiveExpress:"rgba(106,76,147,0.08)", ReflectiveReceive:"rgba(166,140,194,0.08)",
      SupportiveExpress:"rgba(136,192,208,0.08)", SupportiveReceive:"rgba(178,223,219,0.08)",
      AffableExpress:"rgba(76,175,80,0.08)", AffableReceive:"rgba(163,217,119,0.08)",
      StrongWilledExpress:"rgba(230,57,70,0.08)", StrongWilledReceive:"rgba(255,122,112,0.08)",
      SteadyConnector:"rgba(76,175,80,0.08)", ReassuranceSeeker:"rgba(255,173,173,0.08)",
      IndependentConnector:"rgba(136,192,208,0.08)", GuardedConnector:"rgba(165,165,165,0.08)"
    };

    var intimacyDescriptions = {
      Spiritual:{desc:"You value a shared faith or sense of purpose, connecting through beliefs and values that guide your life together.",tip:"Engage in a weekly spiritual practice to deepen your bond."},
      Emotional:{desc:"You seek emotional safety and vulnerability, thriving when you feel deeply known and understood.",tip:"Schedule uninterrupted time for heartfelt conversation."},
      Commitment:{desc:"You prioritize trust and loyalty, finding security in a steadfast partnership.",tip:"Review shared goals and keep small promises."},
      Intellectual:{desc:"You connect through stimulating ideas and thoughtful discussions.",tip:"Read something together and discuss it."},
      Affable:{desc:"You cherish kindness, peace, and joy, building warmth through calm and caring moments.",tip:"Plan a relaxing, low-pressure evening."},
      Recreational:{desc:"You bond through shared activities and adventures.",tip:"Plan a small adventure or playful activity."},
      Partnership:{desc:"You value teamwork and collaboration.",tip:"Pick a small project to do together."},
      Stability:{desc:"You find unity through transparent planning of resources.",tip:"Hold a short planning check-in."},
      Creative:{desc:"You connect through imagination and collaboration.",tip:"Start a light creative task together."},
      Conflict:{desc:"You grow closer through respectful resolution.",tip:"Practice active listening in your next disagreement."},
      Physical:{desc:"You feel loved through non-sexual touch that fosters security.",tip:"Add consistent, warm daily touch."},
      Sexual:{desc:"You express intimacy through sexual connection.",tip:"Discuss desires and schedule protected time."}
    };

    var scriptures = {
      "Compassion and Care": "“Be completely humble and gentle; be patient, bearing with one another in love.” — Ephesians 4:2",
      "Social Engagement": "“Live in harmony with one another.” — Romans 12:16",
      "Decision-Making and Leadership": "“Plans fail for lack of counsel, but with many advisers they succeed.” — Proverbs 15:22",
      "Respect and Recognition": "“Be devoted to one another in love. Honor one another above yourselves.” — Romans 12:10",
      "30-Day Discussion & Strategy": "“And over all these virtues put on love, which binds them all together in perfect unity.” — Colossians 3:14",
      "Partner Alignment Discussion": "“Two are better than one… If either falls, one can help the other up.” — Ecclesiastes 4:9–10"
    };

    var bondingInsights = {
      SteadyConnector:{desc:"You create a safe space for open communication, fostering resilience and mutual understanding.",challenges:"You may assume quick communication resolves all issues.",conflictStyle:"Seeks harmony; may avoid deeper issues.",tip:"Weekly check-ins where both share feelings."},
      ReassuranceSeeker:{desc:"You thrive on frequent affirmations and emotional vibrancy.",challenges:"Desire for validation may overwhelm your spouse.",conflictStyle:"May over-pursue reassurance, escalating tension.",tip:"Ask for a simple daily affirmation."},
      IndependentConnector:{desc:"Your steady presence brings calm and stability.",challenges:"Space can be perceived as distance.",conflictStyle:"May withdraw to avoid conflict.",tip:"Plan a quiet, no-pressure evening weekly."},
      GuardedConnector:{desc:"You build trust gradually, creating dependable bonds.",challenges:"Guardedness can slow emotional openness.",conflictStyle:"May assume negative intent and get defensive.",tip:"Adopt a small, daily trust-building ritual."}
    };

    var actionPlans = {
      Spiritual:{SteadyConnector:"Join a faith-based group and reflect weekly.",ReassuranceSeeker:"Daily shared prayer/affirmation.",IndependentConnector:"Quiet individual reflection, then share.",GuardedConnector:"Weekly short ritual to build trust."},
      Emotional:{SteadyConnector:"20-minute weekly heart-talk.",ReassuranceSeeker:"Ask for daily words of reassurance.",IndependentConnector:"Monthly deep talk to balance space.",GuardedConnector:"One vulnerable share daily."},
      Commitment:{SteadyConnector:"Monthly review of shared goals.",ReassuranceSeeker:"Weekly tangible commitment gesture.",IndependentConnector:"Quarterly goal-setting session.",GuardedConnector:"Daily mini-ritual of commitment."},
      Intellectual:{SteadyConnector:"Weekly article/book chat.",ReassuranceSeeker:"Share an idea daily.",IndependentConnector:"Read separately; discuss monthly.",GuardedConnector:"Low-pressure journal exchange."},
      Affable:{SteadyConnector:"Weekly quiet evening.",ReassuranceSeeker:"Daily kind gesture.",IndependentConnector:"Monthly relaxing outing.",GuardedConnector:"Daily small kindness."},
      Recreational:{SteadyConnector:"Weekly activity (walk/cook).",ReassuranceSeeker:"Regular shared adventures.",IndependentConnector:"Monthly group activity.",GuardedConnector:"Low-key weekly activity."},
      Partnership:{SteadyConnector:"Weekly joint project.",ReassuranceSeeker:"Regular collaboration on tasks.",IndependentConnector:"Monthly shared task.",GuardedConnector:"Small weekly task."},
      Stability:{SteadyConnector:"Weekly 10-min planning huddle.",ReassuranceSeeker:"Transparent weekly updates.",IndependentConnector:"Monthly review.",GuardedConnector:"Weekly transparency check-in."},
      Creative:{SteadyConnector:"Weekly creative micro-project.",ReassuranceSeeker:"Regular creative collab.",IndependentConnector:"Monthly creative night.",GuardedConnector:"Low-pressure weekly creative task."},
      Conflict:{SteadyConnector:"Weekly active-listening practice.",ReassuranceSeeker:"Ask for reassurance + slow down.",IndependentConnector:"Set space, then reconvene.",GuardedConnector:"Daily respectful dialogue habit."},
      Physical:{SteadyConnector:"Daily warm touch.",ReassuranceSeeker:"Frequent small gestures.",IndependentConnector:"Planned moments monthly.",GuardedConnector:"Daily micro-gestures."},
      Sexual:{SteadyConnector:"Weekly intimacy + dialogue.",ReassuranceSeeker:"Regular affirmation of passion.",IndependentConnector:"Monthly intimacy plan.",GuardedConnector:"Weekly desire conversation."}
    };

    var conflictStrategies = {
      SteadyConnector:{SteadyConnector:"Both value harmony; use weekly check-ins to address issues early.",ReassuranceSeeker:"Offer affirmations during conflict; don’t rush.",IndependentConnector:"Allow space, then discuss with a time box.",GuardedConnector:"Patient, empathetic listening; avoid pressuring openness."},
      ReassuranceSeeker:{SteadyConnector:"Ask for a specific affirmation calmly.",ReassuranceSeeker:"Schedule mutual-validation check-ins.",IndependentConnector:"Offer reassurance, then allow space.",GuardedConnector:"Gentle, clear requests to reduce defensiveness."},
      IndependentConnector:{SteadyConnector:"Explain need for reflection to keep harmony.",ReassuranceSeeker:"Offer reassurance before taking space.",IndependentConnector:"Agree on a resolution timeline.",GuardedConnector:"Initiate gentle check-ins to build trust."},
      GuardedConnector:{SteadyConnector:"Share feelings gradually to align with harmony.",ReassuranceSeeker:"Offer small affirmations to ease tension.",IndependentConnector:"Use structured check-ins.",GuardedConnector:"Build trust with small gestures before tough talks."}
    };

    /* ========= Questions ========= */
    var questions = [
      { q:"When your spouse is stressed, what's your first instinct?", opts:[
        { text:"Lighten the mood with fun or a distraction.", t:"Extroverted", i:"Recreational", style:"Recreational" },
        { text:"Take charge and solve the problem.", t:"StrongWilled", i:"Conflict", style:"Reflective" },
        { text:"Offer thoughtful advice or discuss the issue deeply.", t:"Reflective", i:"Intellectual", style:"Supportive" },
        { text:"Listen quietly and offer comfort.", t:"Affable", i:"Affable", style:"Emotional" },
        { text:"Help them quietly without being asked.", t:"Supportive", i:"Partnership", style:"Partnership" }
      ]},
      { q:"What's your ideal weekend plan?", opts:[
        { text:"Spontaneous and exciting activities.", t:"Extroverted", i:"Recreational", style:"Recreational" },
        { text:"Tackling a project or goal.", t:"StrongWilled", i:"Partnership", style:"Reflective" },
        { text:"Reading or working on a creative project.", t:"Reflective", i:"Creative", style:"Supportive" },
        { text:"Relaxing at home quietly.", t:"Affable", i:"Affable", style:"Emotional" },
        { text:"Helping family or serving others.", t:"Supportive", i:"Commitment", style:"Partnership" }
      ]},
      { q:"How do you respond to your spouse's sadness?", opts:[
        { text:"Try to make them smile.", t:"Extroverted", i:"Recreational", style:"Recreational" },
        { text:"Fix the cause of their sadness.", t:"StrongWilled", i:"Conflict", style:"Reflective" },
        { text:"Have a deep conversation about it.", t:"Reflective", i:"Intellectual", style:"Supportive" },
        { text:"Offer a hug and physical comfort.", t:"Affable", i:"Physical", style:"Emotional" },
        { text:"Perform a kind act to show care.", t:"Supportive", i:"Partnership", style:"Partnership" }
      ]},
      { q:"What's your role in group settings?", opts:[
        { text:"Engaging everyone with enthusiasm.", t:"Extroverted", i:"Recreational", style:"Recreational", domain:"Social" },
        { text:"Leading or organizing the group.", t:"StrongWilled", i:"Conflict", style:"Reflective", domain:"Social" },
        { text:"Listening and observing.", t:"Reflective", i:"Intellectual", style:"Supportive", domain:"Social" },
        { text:"Following the group's decisions.", t:"Affable", i:"Affable", style:"Emotional", domain:"Social" },
        { text:"Ensuring others feel supported.", t:"Supportive", i:"Partnership", style:"Partnership", domain:"Social" }
      ]},
      { q:"What's your ideal date night?", opts:[
        { text:"Fun and spontaneous.", t:"Extroverted", i:"Recreational", style:"Recreational" },
        { text:"Working on a shared goal.", t:"StrongWilled", i:"Commitment", style:"Reflective" },
        { text:"Deep, meaningful activity.", t:"Reflective", i:"Creative", style:"Supportive" },
        { text:"Low-key night in.", t:"Affable", i:"Affable", style:"Emotional" },
        { text:"Serving or honoring my spouse.", t:"Supportive", i:"Partnership", style:"Partnership" }
      ]},
      { q:"How do you approach decisions?", opts:[
        { text:"Go with what's fun.", t:"Extroverted", i:"Emotional", style:"Recreational", domain:"Decision" },
        { text:"Make quick, decisive choices.", t:"StrongWilled", i:"Conflict", style:"Reflective", domain:"Decision" },
        { text:"Analyze all details.", t:"Reflective", i:"Intellectual", style:"Supportive", domain:"Decision" },
        { text:"Keep peace and go with the flow.", t:"Affable", i:"Affable", style:"Emotional", domain:"Decision" },
        { text:"Consider others' wants.", t:"Supportive", i:"Commitment", style:"Partnership", domain:"Decision" }
      ]},
      { q:"How do you react during conflict?", opts:[
        { text:"Use humor to diffuse tension.", t:"Extroverted", i:"Emotional", style:"Recreational", b:"SteadyConnector" },
        { text:"Push for a resolution.", t:"StrongWilled", i:"Conflict", style:"Reflective", b:"ReassuranceSeeker" },
        { text:"Retreat to think.", t:"Reflective", i:"Intellectual", style:"Supportive", b:"IndependentConnector" },
        { text:"Stay calm to avoid escalation.", t:"Affable", i:"Affable", style:"Emotional", b:"IndependentConnector" },
        { text:"Concede to end conflict.", t:"Supportive", i:"Commitment", style:"Partnership", b:"GuardedConnector" }
      ]},
      { q:"How do you express affection?", opts:[
        { text:"Fun words and excitement.", t:"Extroverted", i:"Emotional", style:"Recreational", domain:"Affection" },
        { text:"Doing tasks to help.", t:"StrongWilled", i:"Partnership", style:"Reflective", domain:"Affection" },
        { text:"Meaningful conversations.", t:"Reflective", i:"Creative", style:"Supportive", domain:"Affection" },
        { text:"Physical touch or presence.", t:"Affable", i:"Physical", style:"Emotional", domain:"Affection" },
        { text:"Serving quietly.", t:"Supportive", i:"Partnership", style:"Partnership", domain:"Affection" }
      ]},
      { q:"How do you prioritize your time or money?", opts:[
        { text:"Spend on fun experiences.", t:"Extroverted", i:"Recreational", style:"Recreational" },
        { text:"Invest in goals or efficiency.", t:"StrongWilled", i:"Stability", style:"Reflective" },
        { text:"Allocate thoughtfully after planning.", t:"Reflective", i:"Stability", style:"Supportive" },
        { text:"Use flexibly to keep peace.", t:"Affable", i:"Affable", style:"Emotional" },
        { text:"Share generously with others.", t:"Supportive", i:"Partnership", style:"Partnership" }
      ]},
      { q:"Do you feel your opinions are respected?", opts:[
        { text:"Strongly Agree", rr:3 },{ text:"Agree", rr:2 },{ text:"Somewhat Agree", rr:1 },{ text:"Disagree", rr:0 },{ text:"Strongly Disagree", rr:0 }
      ]},
      { q:"Are you and your spouse aligned on values?", opts:[
        { text:"Strongly Agree", rr:3 },{ text:"Agree", rr:2 },{ text:"Somewhat Agree", rr:1 },{ text:"Disagree", rr:0 },{ text:"Strongly Disagree", rr:0 }
      ]}
    ];

    /* ========= State ========= */
    function $(id){ return document.getElementById(id); }
    var mode = "individual";
    var currentPartnerIndex = 0; // 0 = P1, 1 = P2
    var partnerNames = ["Partner 1", "Partner 2"];
    var partnerProfiles = [];

    // Per-run (one partner)
    var index = 0,
        tempScores = {},
        wantedTempScores = {},
        socialTempScores = {},
        decisionTempScores = {},
        intimacyScores = {},
        bondingScores = {},
        styleScores = {},
        respectRecognitionScore = 0,
        answers = [];

    // Click lock to prevent double fire / loops
    var questionLock = false;

    function resetScores() {
      tempScores = { Extroverted:0, StrongWilled:0, Reflective:0, Affable:0, Supportive:0 };
      wantedTempScores = { Extroverted:0, StrongWilled:0, Reflective:0, Affable:0, Supportive:0 };
      socialTempScores = { Extroverted:0, StrongWilled:0, Reflective:0, Affable:0, Supportive:0 };
      decisionTempScores = { Extroverted:0, StrongWilled:0, Reflective:0, Affable:0, Supportive:0 };
      styleScores = { Extroverted:0, StrongWilled:0, Reflective:0, Affable:0, Supportive:0 };
      intimacyScores = {}; Object.keys(intimacyDescriptions).forEach(function(k){ intimacyScores[k] = 0; });
      bondingScores = {};
      respectRecognitionScore = 0;
      answers = [];
      index = 0;
      questionLock = false;
    }

    function normalizeIntimacyScores() {
      var questionCounts = {
        Spiritual:0, Emotional:3, Commitment:2, Intellectual:3, Affable:4,
        Recreational:3, Partnership:4, Stability:2, Creative:2, Conflict:2,
        Physical:2, Sexual:0
      };
      var normalized = {};
      Object.keys(intimacyScores).forEach(function(type){
        normalized[type] = questionCounts[type] ? (intimacyScores[type] / questionCounts[type]) * 3 : 0;
      });
      return normalized;
    }

    function getAffectionPreferences() {
      function topKey(obj){ return Object.keys(obj).sort(function(a,b){return obj[b]-obj[a];})[0] || 'Extroverted'; }
      var highestExpressed = topKey(tempScores);
      var highestWanted = topKey(wantedTempScores);
      var prefs = {
        Extroverted:{expressed:"You express love in a recreational style, using fun, lighthearted interactions to create joy.", desired:"You feel loved when your spouse connects in a recreational style."},
        StrongWilled:{expressed:"You express love in a reflective style by solving problems/helping.", desired:"You feel loved when supported in a reflective style."},
        Reflective:{expressed:"You express love in a supportive style through deep, meaningful exchanges.", desired:"You feel loved when offered meaningful connection in a supportive style."},
        Affable:{expressed:"You express love in an emotional style with warmth and gentle presence.", desired:"You feel loved through peaceful companionship in an emotional style."},
        Supportive:{expressed:"You express love in a partnership style through shared goals and help.", desired:"You feel loved through intentional collaboration in a partnership style."}
      };
      return {
        expressed: prefs[highestExpressed].expressed,
        expressedType: highestExpressed + "Express",
        desired: prefs[highestWanted].desired,
        desiredType: highestWanted + "Receive"
      };
    }
    function getSocialPreferences() {
      var top = Object.keys(socialTempScores).sort(function(a,b){return socialTempScores[b]-socialTempScores[a];})[0];
      var d = {
        Extroverted:"You bring energy and enthusiasm to social settings.",
        StrongWilled:"You lead and organize with confidence.",
        Reflective:"You prefer deep, thoughtful conversations.",
        Affable:"You enjoy calm, low-key interactions.",
        Supportive:"You support others quietly, fostering inclusion."
      };
      return d[top] || "You flex between engagement and solitude as needed.";
    }
    function getDecisionLeadershipStyle() {
      var top = Object.keys(decisionTempScores).sort(function(a,b){return decisionTempScores[b]-decisionTempScores[a];})[0];
      var s = {
        Extroverted:"You decide with enthusiasm, prioritizing enjoyment.",
        StrongWilled:"You decide decisively with clear goals.",
        Reflective:"You analyze thoroughly before deciding.",
        Affable:"You choose harmony and peace in decisions.",
        Supportive:"You collaborate and support shared choices."
      };
      return s[top] || "You balance leadership and collaboration in decisions.";
    }
    function getBondingStyle() {
      var top = Object.keys(bondingScores).sort(function(a,b){return bondingScores[b]-bondingScores[a];})[0];
      return top || "SteadyConnector";
    }
    function respectSummary(score) {
      return score >= 5 ? "You feel strongly respected and aligned—solid ground for intimacy."
           : score >= 3 ? "Moderate respect/alignment with room to deepen understanding."
                        : "You may desire more recognition and alignment to strengthen connection.";
    }

    /* ========= UI wiring ========= */
    $('mode').addEventListener('change', function(){
      mode = $('mode').value;
      if (mode !== 'couple') { $('coupleFields').classList.add('hidden'); }
      else { $('coupleFields').classList.remove('hidden'); }
    });

    $('startQuizBtn').addEventListener('click', function(){
      mode = $('mode').value;
      if (mode === 'couple') {
        var p1 = $('p1Name').value.trim();
        var p2 = $('p2Name').value.trim();
        if (!p1 || !p2) { alert('Please enter both partner names.'); return; }
        partnerNames = [p1, p2];
      } else {
        partnerNames = ['You', 'Partner'];
      }
      currentPartnerIndex = 0;
      startPartnerRun();
    });

    $('backBtn').addEventListener('click', function(){ goBack(); });

    function startPartnerRun() {
      resetScores();
      $('introPage').classList.add('hidden');
      $('resultPage').classList.add('hidden');
      $('quizPage').classList.remove('hidden');
      $('quizHeading').textContent = (mode === 'couple')
        ? ('Intimacy Profile Assessment — ' + partnerNames[currentPartnerIndex])
        : 'Intimacy Profile Assessment';
      showQuestion();
    }

    function showQuestion() {
      if (index >= questions.length) { finishPartnerRun(); return; }

      var q = questions[index];
      var progress = $('progress');
      var progressBar = $('progressBar');
      var container = $('questionContainer');

      progress.textContent = 'Question ' + (index + 1) + ' of ' + questions.length;
      progressBar.style.width = (((index + 1) / questions.length) * 100) + '%';

      var html = '<h3 id="questionLabel">' + q.q + '</h3>';
      q.opts.forEach(function(o, i){
        html += '<button class="answer-btn" role="radio" aria-checked="false" aria-labelledby="questionLabel" data-i="'+i+'">'+o.text+'</button>';
      });
      container.innerHTML = html;

      questionLock = false;

      container.onclick = function(ev){
        var target = ev.target;
        var btn = null;
        while (target && target !== container) {
          if (target.classList && target.classList.contains('answer-btn')) { btn = target; break; }
          target = target.parentNode;
        }
        if (!btn || questionLock) return;
        questionLock = true;
        var i = Number(btn.getAttribute('data-i'));
        if (!isFinite(i)) { questionLock = false; return; }
        btn.classList.add('selected');
        setTimeout(function(){ recordAnswer(i); }, 120);
      };

      if (index === 0) $('backBtn').classList.add('hidden'); else $('backBtn').classList.remove('hidden');
    }

    function recordAnswer(i) {
      if (index >= questions.length) { finishPartnerRun(); return; }

      var o = questions[index].opts[i];
      answers[index] = i;

      if (o.t) {
        if (o.domain === "Affection" && o.wanted) wantedTempScores[o.t]++;
        else if (o.domain === "Social") socialTempScores[o.t]++;
        else if (o.domain === "Decision") decisionTempScores[o.t]++;
        else tempScores[o.t]++;
        styleScores[o.t]++;
      }
      if (o.i) intimacyScores[o.i] = (intimacyScores[o.i] || 0) + 1;
      if (o.b) bondingScores[o.b] = (bondingScores[o.b] || 0) + 1;
      if (o.rr !== undefined) respectRecognitionScore += o.rr;

      index++;
      if (index < questions.length) { showQuestion(); }
      else { finishPartnerRun(); }
    }

    function goBack() {
      if (index === 0) return;
      index--;
      var prev = answers[index];
      if (prev != null) {
        var o = questions[index].opts[prev];
        if (o.t) {
          if (o.domain === "Affection" && o.wanted) wantedTempScores[o.t]--;
          else if (o.domain === "Social") socialTempScores[o.t]--;
          else if (o.domain === "Decision") decisionTempScores[o.t]--;
          else tempScores[o.t]--;
          styleScores[o.t]--;
        }
        if (o.i) intimacyScores[o.i]--;
        if (o.b) bondingScores[o.b]--;
        if (o.rr !== undefined) respectRecognitionScore -= o.rr;
        answers[index] = undefined;
      }
      questionLock = false;
      showQuestion();
    }

    function computeProfile() {
      var normalized = normalizeIntimacyScores();
      var sorted = Object.keys(normalized).map(function(k){ return [k, normalized[k]]; }).sort(function(a,b){ return b[1]-a[1]; });
      var priority = sorted.slice(0,4);
      var progress = sorted.slice(4,8);
      var presence = sorted.slice(8,12);
      var affection = getAffectionPreferences();
      var social = getSocialPreferences();
      var decision = getDecisionLeadershipStyle();
      var bondingKey = getBondingStyle();
      var bondingLabel = (bondingKey || 'SteadyConnector').replace(/([a-z])([A-Z])/g,'$1 $2');
      var respectText = respectSummary(respectRecognitionScore);
      return { normalized:normalized, sorted:sorted, priority:priority, progress:progress, presence:presence, affection:affection, social:social, decision:decision, bondingKey:bondingKey, bondingLabel:bondingLabel, respectText:respectText };
    }

    function block(type, extraHtml) {
      var border = (typeColors && typeColors[type]) ? typeColors[type] : '#4D9DE0';
      var bg = (typeColorsWithOpacity && typeColorsWithOpacity[type]) ? typeColorsWithOpacity[type] : 'rgba(77,157,224,0.08)';
      return '<div class="result-block" style="border-left-color:'+border+'; background:'+bg+';">'+(extraHtml || '')+'</div>';
    }
    function scriptureLine(title) {
      var verse = (scriptures && scriptures[title]) || "";
      return verse ? '<div class="scripture-line">'+verse+'</div>' : "";
    }
    function sectionHTML(title, text, items, prompts) {
      prompts = prompts || [];
      var cards = (items || []).map(function(pair){
        var type = Array.isArray(pair) ? pair[0] : pair;
        var desc = (intimacyDescriptions && intimacyDescriptions[type] && intimacyDescriptions[type].desc) ? intimacyDescriptions[type].desc : "(description unavailable)";
        var color = (typeColors && typeColors[type]) ? typeColors[type] : '#4D9DE0';
        var bg = (typeColorsWithOpacity && typeColorsWithOpacity[type]) ? typeColorsWithOpacity[type] : 'rgba(77,157,224,0.08)';
        return '<div class="result-block" style="border-left:8px solid '+color+'; background-color:'+bg+';"><strong>'+ (type || 'Unknown') +'</strong> – '+ desc +'</div>';
      }).join('');
      var promptsHtml = prompts.length ? '<div class="discussion-prompts"><h5>Discussion Prompts</h5><ul>'+prompts.map(function(p){return '<li>'+p+'</li>';}).join('')+'</ul></div>' : '';
      return '<div><div class="subsection-divider"></div><h4 class="subsection-title">'+title+'</h4>'+scriptureLine(title)+'<p class="intro-text">'+text+'</p>'+cards+promptsHtml+'</div>';
    }

    function renderSingleProfile(p, nameLabel) {
      var priority = p.priority || [];
      var progress = p.progress || [];
      var presence = p.presence || [];
      var affection = p.affection || {};
      var social = p.social || '';
      var decision = p.decision || '';
      var bondingKey = p.bondingKey || 'SteadyConnector';
      var bondingLabel = p.bondingLabel || 'Steady Connector';
      var respectText = p.respectText || '';
      var expressedType = affection.expressedType || 'ExtrovertedExpress';
      var desiredType = affection.desiredType || 'ExtrovertedReceive';
      var sec2Prompts = [
        "Steward your strengths—use them intentionally twice this week.",
        "Choose one growth area to practice once this week.",
        "Pick one untapped opportunity to experiment with together."
      ];
      return ''+
        '<div class="section-divider"></div>'+
        '<div class="partner-name">'+(nameLabel || 'Partner')+'</div>'+

        sectionHTML("Your Intimacy Type Preferences","Your results highlight how you naturally connect, where growth is possible, and new ways to bond.",[],[]) +
        sectionHTML("Core Connection Strengths","These top four intimacy types are where you naturally excel.",priority,sec2Prompts) +
        sectionHTML("Areas for Growth","These middle four types will improve with a little intentional focus.",progress) +
        sectionHTML("Untapped Opportunities","These lower four types may be overlooked—trying one can open a new door.",presence) +

        '<div class="subsection-divider"></div>'+
        '<h4 class="subsection-title">Compassion and Care</h4>'+
        scriptureLine("Compassion and Care")+
        block(expressedType, '<strong>How You Express Love:</strong> '+(affection.expressed || '')+'<p class="action-tip">Tip: Share how these expressions feel natural to you.</p>')+
        block(desiredType, '<strong>How You Feel Loved:</strong> '+(affection.desired || '')+'<p class="action-tip">Tip: Tell your spouse what helps you feel valued.</p>')+
        '<div class="discussion-prompts"><h5>Discussion Prompts</h5><ul><li>Which expression feels most natural to you? Which request helps you feel most loved?</li><li>What small practice could your spouse try this week to speak your “love language” better?</li></ul></div>'+

        '<h4 class="subsection-title">Social Engagement</h4>'+
        scriptureLine("Social Engagement")+
        block('ExtrovertedExpress', '<strong>Your Social Style:</strong> '+social)+
        '<div class="discussion-prompts"><h5>Discussion Prompts</h5><ul><li>Where do your social needs align or differ? Plan one event that fits both.</li></ul></div>'+

        '<h4 class="subsection-title">Decision-Making and Leadership</h4>'+
        scriptureLine("Decision-Making and Leadership")+
        block('ReflectiveExpress', '<strong>Your Decision Style:</strong> '+decision)+
        '<div class="discussion-prompts"><h5>Discussion Prompts</h5><ul><li>How can your decision styles complement each other this month?</li></ul></div>'+

        '<h4 class="subsection-title">Respect and Recognition</h4>'+
        scriptureLine("Respect and Recognition")+
        block('Spiritual', '<strong>Your Alignment:</strong> '+respectText)+
        '<div class="discussion-prompts"><h5>Discussion Prompts</h5><ul><li>What specific actions help you feel honored and recognized?</li></ul></div>'+

        block(bondingKey, '<strong>Connection Pattern:</strong> '+bondingLabel+'<br/><strong>Strengths:</strong> '+(bondingInsights[bondingKey] ? bondingInsights[bondingKey].desc : '')+'<br/><strong>Challenges:</strong> '+(bondingInsights[bondingKey] ? bondingInsights[bondingKey].challenges : '')+'<br/><strong>Conflict Style:</strong> '+(bondingInsights[bondingKey] ? bondingInsights[bondingKey].conflictStyle : ''))
      ;
    }

    function renderCoupleComparison(p1, p2) {
      var top1 = (p1.priority || []).map(function(x){return x[0];});
      var top2 = (p2.priority || []).map(function(x){return x[0];});
      var overlap = top1.filter(function(t){return top2.indexOf(t) >= 0;});
      var only1 = top1.filter(function(t){return overlap.indexOf(t) < 0;});
      var only2 = top2.filter(function(t){return overlap.indexOf(t) < 0;});

      var want1 = (p1.affection && p1.affection.desiredType ? p1.affection.desiredType : '').replace(/(Express|Receive)$/,'');
      var want2 = (p2.affection && p2.affection.desiredType ? p2.affection.desiredType : '').replace(/(Express|Receive)$/,'');
      var express1 = (p1.affection && p1.affection.expressedType ? p1.affection.expressedType : '').replace(/(Express|Receive)$/,'');
      var express2 = (p2.affection && p2.affection.expressedType ? p2.affection.expressedType : '').replace(/(Express|Receive)$/,'');

      var youFillThem = (express1 && want2 && (express1 === want2)) ? 'Great fit!' : 'Add a simple weekly practice in ' + (want2 || 'their preferred style') + '.';
      var theyFillYou = (express2 && want1 && (express2 === want1)) ? 'Great fit!' : 'Add a weekly practice in ' + (want1 || 'their preferred style') + '.';

      var strat12 = (conflictStrategies[p1.bondingKey] && conflictStrategies[p1.bondingKey][p2.bondingKey]) ? conflictStrategies[p1.bondingKey][p2.bondingKey] : "Use weekly check-ins and reflective listening.";
      var strat21 = (conflictStrategies[p2.bondingKey] && conflictStrategies[p2.bondingKey][p1.bondingKey]) ? conflictStrategies[p2.bondingKey][p1.bondingKey] : "Use weekly check-ins and reflective listening.";

      return ''+
        '<div class="section-divider"></div>'+
        '<h3 class="section-title">Couple Comparison</h3>'+

        '<div class="two-col">'+
          '<div>'+
            '<div class="partner-name">'+partnerNames[0]+'</div>'+
            block(p1.priority && p1.priority[0] ? p1.priority[0][0] : 'Partnership', '<strong>Top Intimacy:</strong> '+(p1.priority && p1.priority[0] ? p1.priority[0][0] : ''))+
            block(p1.affection && p1.affection.expressedType ? p1.affection.expressedType : 'AffableExpress', '<strong>Expresses Love:</strong> '+(p1.affection ? p1.affection.expressed : ''))+
            block(p1.affection && p1.affection.desiredType ? p1.affection.desiredType : 'SupportiveReceive', '<strong>Feels Loved By:</strong> '+(p1.affection ? p1.affection.desired : ''))+
            block(p1.bondingKey || 'SteadyConnector', '<strong>Connection Pattern:</strong> '+(p1.bondingLabel || ''))+
            block(p1.priority && p1.priority[0] ? p1.priority[0][0] : 'Partnership', '<strong>30-Day Action:</strong> '+((actionPlans[p1.priority && p1.priority[0] ? p1.priority[0][0] : 'Partnership'] || {})[p1.bondingKey || 'SteadyConnector'] || ''))+
          '</div>'+
          '<div>'+
            '<div class="partner-name">'+partnerNames[1]+'</div>'+
            block(p2.priority && p2.priority[0] ? p2.priority[0][0] : 'Partnership', '<strong>Top Intimacy:</strong> '+(p2.priority && p2.priority[0] ? p2.priority[0][0] : ''))+
            block(p2.affection && p2.affection.expressedType ? p2.affection.expressedType : 'AffableExpress', '<strong>Expresses Love:</strong> '+(p2.affection ? p2.affection.expressed : ''))+
            block(p2.affection && p2.affection.desiredType ? p2.affection.desiredType : 'SupportiveReceive', '<strong>Feels Loved By:</strong> '+(p2.affection ? p2.affection.desired : ''))+
            block(p2.bondingKey || 'SteadyConnector', '<strong>Connection Pattern:</strong> '+(p2.bondingLabel || ''))+
            block(p2.priority && p2.priority[0] ? p2.priority[0][0] : 'Partnership', '<strong>30-Day Action:</strong> '+((actionPlans[p2.priority && p2.priority[0] ? p2.priority[0][0] : 'Partnership'] || {})[p2.bondingKey || 'SteadyConnector'] || ''))+
          '</div>'+
        '</div>'+

        '<div class="subsection-divider"></div>'+
        '<h4 class="subsection-title">Top-4 Intimacy: Overlap & Differences</h4>'+
        '<div class="table-responsive"><table><tr><th>Overlap</th><th>Only '+partnerNames[0]+'</th><th>Only '+partnerNames[1]+'</th></tr>'+
        '<tr><td>'+ (overlap.length ? overlap.join(', ') : 'None') +'</td><td>'+ (only1.length ? only1.join(', ') : 'None') +'</td><td>'+ (only2.length ? only2.join(', ') : 'None') +'</td></tr></table></div>'+
        '<div class="discussion-prompts"><h5>Discussion Prompts</h5><ul><li>Plan one ‘overlap’ date this week; choose one “only” from each partner next week.</li></ul></div>'+

        '<div class="subsection-divider"></div>'+
        '<h4 class="subsection-title">Affection Alignment</h4>'+
        '<div class="two-col">'+
          block('AffableExpress', '<strong>'+partnerNames[0]+' → '+partnerNames[1]+':</strong> '+youFillThem)+
          block('SupportiveExpress', '<strong>'+partnerNames[1]+' → '+partnerNames[0]+':</strong> '+theyFillYou)+
        '</div>'+
        '<div class="discussion-prompts"><h5>Discussion Prompts</h5><ul><li>What’s one weekly practice each of you will do to meet the other’s desired style?</li></ul></div>'+

        '<div class="subsection-divider"></div>'+
        '<h4 class="subsection-title">Personalized Conflict Resolution Strategies</h4>'+
        '<div class="table-responsive"><table><tr><th>Partner</th><th>Pattern</th><th>Strategy With Other</th></tr>'+
        '<tr><td>'+partnerNames[0]+'</td><td>'+ (p1.bondingLabel || '') +'</td><td>'+strat12+'</td></tr>'+
        '<tr><td>'+partnerNames[1]+'</td><td>'+ (p2.bondingLabel || '') +'</td><td>'+strat21+'</td></tr>'+
        '</table></div>'
      ;
    }

    function renderResults() {
      var results = $('results');
      var coupleResults = $('coupleResults');
      results.innerHTML = '';
      coupleResults.innerHTML = '';

      var title5 = "30-Day Discussion & Strategy";
      var title6 = "Partner Alignment Discussion";

      var haveP1 = !!partnerProfiles[0];
      var haveP2 = !!partnerProfiles[1];

      if (mode === 'individual' || (mode === 'couple' && haveP1 && !haveP2)) {
        var p = haveP1 ? partnerProfiles[0] : computeProfile();
        results.innerHTML = renderSingleProfile(p, partnerNames[0] || 'You');
        results.innerHTML += ''+
          '<div class="section-divider"></div>'+
          '<h3 class="section-title">'+title5+'</h3>'+
          scriptureLine(title5)+
          '<p class="intro-text">Use your top intimacy ('+(p.priority && p.priority[0] ? p.priority[0][0] : '—')+') and connection pattern ('+(p.bondingLabel || '—')+') to co-create a plan.</p>'+
          '<div class="discussion-prompts"><h5>Discussion Prompts</h5><ul>'+
          '<li>One small step this week that fits '+(p.priority && p.priority[0] ? p.priority[0][0] : 'your top area')+'?</li>'+
          '<li>How will we support each other given our pattern ('+(p.bondingLabel || '—')+')?</li>'+
          '<li>When will we check in to review progress?</li>'+
          '</ul></div>';

        // Show “Add Partner 2” banner if in couple mode and only P1 exists
        if (mode === 'couple' && haveP1 && !haveP2) {
          $('afterP1Banner').classList.remove('hidden');
          $('startP2Btn').onclick = function(){
            $('afterP1Banner').classList.add('hidden');
            currentPartnerIndex = 1;
            // Pre-fill names and lock fields
            $('introPage').classList.remove('hidden');
            $('mode').value = 'couple';
            $('coupleFields').classList.remove('hidden');
            $('p1Name').value = partnerNames[0];
            $('p2Name').value = partnerNames[1];
            $('p1Name').setAttribute('disabled','true');
            $('p2Name').setAttribute('disabled','true');
            $('startQuizBtn').textContent = "Start " + partnerNames[1] + "'s Assessment";
            $('resultPage').classList.add('hidden');
            // Start Partner 2 on click
            $('startQuizBtn').onclick = function(){
              startPartnerRun();
              // restore default handler after starting partner 2
              setTimeout(function(){
                $('startQuizBtn').onclick = null;
              }, 0);
            };
          };
          $('keepSoloBtn').onclick = function(){
            $('afterP1Banner').classList.add('hidden');
          };
        }
      } else {
        var p1 = partnerProfiles[0] || computeProfile();
        var p2 = partnerProfiles[1] || computeProfile();
        results.innerHTML =
          renderSingleProfile(p1, partnerNames[0] || 'Partner 1') +
          renderSingleProfile(p2, partnerNames[1] || 'Partner 2');
        coupleResults.innerHTML = renderCoupleComparison(p1, p2);

        coupleResults.innerHTML += ''+
          '<div class="section-divider"></div>'+
          '<h3 class="section-title">'+title5+'</h3>'+
          scriptureLine(title5)+
          '<p class="intro-text">Build a 30-day plan that honors '+partnerNames[0]+"'s top intimacy ("+(p1.priority && p1.priority[0] ? p1.priority[0][0] : '—')+') and '+partnerNames[1]+"'s top intimacy ("+(p2.priority && p2.priority[0] ? p2.priority[0][0] : '—')+').</p>'+
          '<div class="discussion-prompts"><h5>Discussion Prompts</h5><ul>'+
          '<li>One shared practice that fits both top intimacies?</li>'+
          '<li>One weekly action each of you will take to meet the other’s desired style?</li>'+
          '<li>When will you check in, and how will you celebrate progress?</li>'+
          '</ul></div>'+

          '<div class="section-divider"></div>'+
          '<h3 class="section-title">'+title6+'</h3>'+
          scriptureLine(title6)+
          '<p class="intro-text">Use overlap and differences to design a rhythm that works for both.</p>'+
          '<div class="discussion-prompts"><h5>Discussion Prompts</h5><ul>'+
          '<li>Choose one ‘overlap’ activity for this week.</li>'+
          '<li>Pick one “only '+partnerNames[0]+'” and one “only '+partnerNames[1]+'” activity for alternating weeks.</li>'+
          '<li>Agree on a quick weekly check-in (time + 2 questions) to adjust your plan.</li>'+
          '</ul></div>';
      }

      $('quizPage').classList.add('hidden');
      $('resultPage').classList.remove('hidden');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function finishPartnerRun() {
      var profile = computeProfile();
      partnerProfiles[currentPartnerIndex] = profile;

      // ALWAYS show results after a run
      renderResults();

      // If we’re in true couple flow and just finished P1, the banner lets them start P2.
      // If they proceed to P2 via banner, startPartnerRun() will run.
    }
  </script>
</body>
</html>
